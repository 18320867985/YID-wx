<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
		<meta name="Keywords" content="" />
		<meta name="Description" content="" />
		<title>商品列表</title>
		<link rel="stylesheet" type="text/css" href="css/cstfont/iconfont.css" />
		<link rel="stylesheet" href="css/all.css" />

	</head>

	<body class="bg-white">

		<!--头部-->
		<header class="child-head prodlist-head mui-bar mui-bar-nav ">
			<a class=" mui-icon iconfont icon-back mui-pull-left"></a>
			<h1 class="mui-title">婴儿车</h1>
		</header>

			<!-- 底部--->
		<nav class="footer mui-bar mui-bar-tab ">
			
			<a class="mui-tab-item mui-active" href="index.html">
				<span class="mui-icon iconfont icon-home"></span>
				<span class="mui-tab-label">首页</span>
			</a>
			
			<a class="mui-tab-item" href="搜索页.html">
				<span class="mui-icon iconfont  icon-sousuo2"></span>
				<span class="mui-tab-label">搜索</span>
			</a>

			<a class="mui-tab-item"  href="分类.html" >
				<span class="mui-icon  iconfont icon-menu"></span>
				<span class="mui-tab-label">全部</span>
			</a>
			<a class="mui-tab-item " href="购物车.html">
				<span class="mui-icon  iconfont icon-shopping"></span>
				<span class="mui-tab-label">购物车</span>
			</a>
			<a class="mui-tab-item " href="我的.html">
				<span class="mui-icon  iconfont icon-geren"></span>
				<span class="mui-tab-label">我的</span>
			</a>
		</nav>


		<!--主体内容-->
		<section class="prodlist mui-content  bg-white">

			<!--左右拖拉菜单-->
			<div class="tab-big">

				<div class="prodlist-menu mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<div class="tab-ttl mui-scroll">
						<a class="tab-item active mui-control-item mui-active" data-id="1" data-target="#a1">
							安全座椅
						</a>
						<a class=" tab-item mui-control-item" data-id="2" data-target="#a2">
							婴儿车
						</a>
						<a class=" tab-item mui-control-item" data-id="3" data-target="#a3">
							餐椅摇椅
						</a>
						<a class=" tab-item mui-control-item" data-id="4" data-target="#a4">
							提篮式座椅
						</a>
						<a class=" tab-item mui-control-item" data-id="5" data-target="#a5">
							学步座椅
						</a>

					</div>
				</div>

				<div class="tab-content ">

					<!--列表-->
					<!--pullToRefresh-big 上拉加载大框-->
					<div class="index-list tab-content-item  active pullToRefresh-big" id="a1">

						<!-- pullToRefresh-box 上拉加载每一项-->
						<div class="mui-row pullToRefresh-box">

						</div>

					</div>

					<div class="index-list tab-content-item   pullToRefresh-big" id="a2">

						<!-- pullToRefresh-box 上拉加载每一项-->
						<div class="mui-row pullToRefresh-box">

						</div>

					</div>
					<div class="index-list tab-content-item   pullToRefresh-big" id="a3">

						<!-- pullToRefresh-box 上拉加载每一项-->
						<div class="mui-row pullToRefresh-box">

						</div>

					</div>
					<div class="index-list tab-content-item  pullToRefresh-big" id="a4">

						<!-- pullToRefresh-box 上拉加载每一项-->
						<div class="mui-row pullToRefresh-box">

						</div>

					</div>
					<div class="index-list tab-content-item   pullToRefresh-big" id="a5">

						<!-- pullToRefresh-box 上拉加载每一项-->
						<div class="mui-row pullToRefresh-box">

						</div>

					</div>

				</div>
			</div>

			<!--置顶-->
			<aside class="zhiding">
				<span class="iconfont icon-top "></span>
			</aside>

		</section>

		<!--模板-->
		<script type="text/template" id="handlebars-templete">

			{{#lists}}

			<div class="mui-col-xs-6">
				<a href="商品详情.html">
					<img src="{{a1}}" alt="img" />
				</a>

				<div class="caption mui-text-left">
					<h4 class="mui-ellipsis width-100">{{a2}}</h4>
					<p class="mui-ellipsis">{{a3}}</p>
					<p>{{a4}}<span>家庭装</span></p>

					<div class="op mui-clearfix mui-ellipsis">
						<span class="text-danger">{{a5}}元/箱</span>
						<button class="btn" type="button">加入购物车</button>
					</div>
				</div>

			</div>

			{{/lists}}

		</script>

		<script src="js/config.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/all.js " type="text/javascript " charset="utf-8 "></script>
		<script src="js/handlebars-v4.0.8.min.js" type="text/javascript" charset="utf-8"></script>

		<script type="text/javascript">
			mui("#index_slider").slider({
				interval: 3000
			});

			// 左右拖拉菜单
			$(".prodlist-menu .mui-scroll").on("tap", ".mui-control-item", function() {

				var _id = $(this).attr("data-id");
				var _bl = $(this).attr("data-bl");
				var _targetId = $(this).attr("data-target");
				var _cont = $(".pullToRefresh-box", _targetId)
				//alert(_targetId)
				if(_bl === undefined) {
					$(this).attr("data-bl", true);

					// 加载icon动画
					var _load = document.createElement("span");
					var _load2 = document.createElement("span");
					var _load3 = document.createElement("span");
					_load.classList.add("load-pullToRefresh");
					_load2.classList.add("iconfont");
					_load2.classList.add("icon-jiazai"); 
					_load2.classList.add("spin"); 
					_load3.innerText = "加载中...";
					_load.appendChild(_load2);
					_load.appendChild(_load3);
					_cont.html(_load);
				
					//setTimeout(function() {

						$.get("json/index.json?pullToRefreshId=" + Math.random().toString(), {
							id: _id
						}, function(data) {

							data = data.constructor === Array ? data : JSON.parse(data);

							 data = common.list.map(data, function(item) {
								item.a2 = _targetId + "#" + item.a2
								return item;
							})  // 发布删掉
							
							var template = Handlebars.compile(document.getElementById("handlebars-templete").innerHTML);
							var html = template({
								lists: data
							});

							_cont.find(".load-pullToRefresh").css("display", "none");
							_cont.append(html);
							getData(1, Number(_id), _targetId, {});

						});

				//	}, 1000);

				}

			});

			// 分页
			mui.ready(function() {
				// 第一次加载
				$(".prodlist-menu .mui-scroll .mui-control-item").eq(0).trigger("tap");
			});

			// ajax 分页
			function getData(indexPage, allPage, pullToRefreshBig, obj) {

				muiPullToRefresh.init({
					indexPage: indexPage, // 当前页
					maxPage: allPage, // 总共页数
					pullToRefreshBig: pullToRefreshBig, // 上拉的大框
					pullToRefreshBox: ".pullToRefresh-box", // 上拉的加载框
					url: "json/index.json", // ajax url
					showText: { // 上拉 的文本
						init: "上拉显示更多",
						down: "上拉显示更多",
						refresh: "正在加载...",
						nomore: "没有更多数据了"
					},
					obj: obj, // ajax 参数
					fn: function(data) {
						data = data.constructor === Array ? data : JSON.parse(data);
						
						//
						 data = common.list.map(data, function(item) {
							item.a2 = pullToRefreshBig + "#" + item.a2
							return item;
						});// 发布删掉
						
						var template = Handlebars.compile(document.getElementById("handlebars-templete").innerHTML);
						var html = template({
							lists: data
						});

						$(".load").css("display", "none");
						$(this.pullToRefreshBig).find(this.pullToRefreshBox).append(html);

					}
				});

			}
		</script>

	</body>

</html>