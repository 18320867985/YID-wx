<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0,minimum-scale=1.0, user-scalable=no" />
		<meta name="Keywords" content="" />
		<meta name="Description" content="" />
		<title>购物车</title>
		<link rel="stylesheet" type="text/css" href="css/cstfont/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="css/radioCheckCstfont/iconfont.css" />
		<link rel="stylesheet" href="css/all.css" />

	</head>

	<body>

		<!--头部-->
		<header class=" mui-bar mui-bar-nav shop-head">
			<a class=" mui-icon iconfont icon-back mui-pull-left"></a>
			<h1 class="mui-title">购物车8888</h1>
			<span class="head-right-btn " data-text='{"edit":"编辑","complate":"完成"}'> 编辑</span>

		</header>
		<!-- 底部--->
		<nav class="footer mui-bar mui-bar-tab ">

			<a class="mui-tab-item " href="index.html">
				<span class="mui-icon iconfont icon-home"></span>
				<span class="mui-tab-label">首页</span>
			</a>

			<a class="mui-tab-item" href="搜索页.html">
				<span class="mui-icon iconfont  icon-sousuo2"></span>
				<span class="mui-tab-label">搜索</span>
			</a>

			<a class="mui-tab-item" href="分类.html">
				<span class="mui-icon  iconfont icon-menu"></span>
				<span class="mui-tab-label">全部</span>
			</a>
			<a class="mui-tab-item  mui-active" href="购物车.html">
				<span class="mui-icon  iconfont icon-shopping">
				<span class="shopcar shopcar-local">0</span>
				</span>
				<span class="mui-tab-label">购物车</span>
			</a>
			<a class="mui-tab-item " href="我的.html">
				<span class="mui-icon  iconfont icon-geren"></span>
				<span class="mui-tab-label">我的</span>
			</a>
		</nav>

		<!--主体内容-->
		<section class=" shop mui-content ">
			<form class="shop-cont">

				<!--
				<div class="shop-item  mui-clearfix">
					<div class="mui-row mui-clearfix">
						<div class="mui-col-xs-1 ">
							<div class="check-box">

								<div class="check-item">
									<input type="checkbox">
								</div>

							</div>
						</div>
						<div class="mui-col-xs-4 ">
							<img src="images/1段奶粉.png" alt="" />
						</div>
						<div class="mui-col-xs-7">
							<ul>
								<li>
									<h4 class="ttl mui-ellipsis">惠氏(Wyeth)惠氏新配方奶粉</h4>
								</li>
								<li class="text-ash">
									<label for="">类型:</label>
									<span>一段奶粉</span>
								</li>
								<li class="mui-clearfix price-box">
									<div class="mui-pull-left">
										<span class="iconfont icon-renminbi text-danger"></span>
										<span class="price text-danger">58.00</span>
									</div>
									<div class=" mui-pull-left">
										<div class="number">
											<button class="minus btn" type="button">-</button>
											<input class="num" type="number" value="1" data-min="1" data-max="9999" data-step="1" />
											<button class="plus btn" type="button">+</button>
										</div>
									</div>

								</li>

							</ul>

						</div>
					</div>

				</div>-->

			</form>

			<!--选择和计算购物车-->
			<div class="shop-select">
				<div class="mui-row mui-clearfix">
					<div class="mui-col-xs-4">
						<div class=" check-big">
							<span class="iconfont icon-checknormal check-all"></span>
							<label class="label-click">全选</label>
						</div>

					</div>

					<div class="mui-col-xs-8 mui-clearfix">
						<div class="edit">
							<div class="js mui-pull-left">
								<label for="">总计：</label>
								<span class="iconfont icon-renminbi text-danger"></span>
								<span class="price text-danger">0.00</span>
								<p>共<span class="count">0</span>件,不含运费</p>
							</div>

							<a href="javascript:;" class="btn mui-pull-right submit-btn" type="button">结算</a>
						</div>

						<div class="complate v-hide">
							<a href="javascript:;" class="btn mui-pull-right delete-btn" type="button">删除</a>
						</div>

					</div>

				</div>
			</div>

		</section>

		<!--模板-->
		<script type="text/template" id="handlebars-templete">

			{{#lists}}

			<div class="shop-item  mui-clearfix">
				<div class="mui-row mui-clearfix">
					<div class="mui-col-xs-1 ">
						<div class="check-box">

							<div class="check-item">
								<input type="checkbox">
							</div>

						</div>
					</div>
					<div class="mui-col-xs-4 ">
						<a href="商品详情.html">
							<img src="images/1段奶粉.png" alt="" />
						</a>

					</div>
					<div class="mui-col-xs-7">
						<ul>
							<li>
								<h4 class="ttl mui-ellipsis">惠氏(Wyeth)惠氏新配方奶粉</h4>
							</li>
							<li class="text-ash">
								<label for="">类型:</label>
								<span>一段奶粉</span>
							</li>
							<li class="mui-clearfix price-box">
								<div class="mui-pull-left">
									<span class="iconfont icon-renminbi text-danger"></span>
									<span class="price text-danger">58.00</span>
								</div>
								<div class=" mui-pull-left">
									<div class="number">
										<button class="minus btn" type="button">-</button>
										<input class="num" type="number" value="1" data-min="1" data-max="9999" data-step="1" />
										<button class="plus btn" type="button">+</button>
									</div>
								</div>

							</li>

						</ul>

					</div>
				</div>

			</div>

			{{/lists}}
		</script>

		<script src="js/config.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/all.js " type="text/javascript " charset="utf-8 "></script>
		<script src="js/handlebars-v4.0.8.min.js" type="text/javascript" charset="utf-8"></script>

		<script type="text/javascript">
			$(function() {
				// page init
				shop.init();

				// 结算
				$(".submit-btn").on("tap", function() {

					alert($(".shop-item input[type=checkbox]:checked").length);
				});

				// 删除购物车
				$(".delete-btn").on("tap", function() {
					var els = $(".shop-item input[type=checkbox]:checked");
					if(els.length === 0) {
						mui.alert("还没有选择数据！", " ", "确定");
						return;
					}
					mui.confirm("确认要删除数据?", " ", ["确认", "取消"], function(e) {

						if(e.index === 0) {
							els.each(function() {
								$(this).parents(".shop-item").remove()
							});

							//  localStorage获取购物车的数量
							var arrs = com.localStorage.getItem("shopcar") || [];
							arrs.splice(0, els.length);
							com.localStorage.setItem("shopcar", arrs);
							getshopCar();
						}

					});

				});

				// localStorage获取购物车的数量
				getshopCar();

				function getshopCar() {
					var arrs = com.localStorage.getItem("shopcar") || [];
					var template = Handlebars.compile(document.getElementById("handlebars-templete").innerHTML);
					var html = template({
						lists: arrs
					});

					$(".shop-cont").html(html);
					$(".shopcar-local").text(arrs.length);
				}

				// numberbox 点击事件
				$(document).on("number_click", function(event, element) {
					//element 当前点击的元素	
						calPrice();

				});

				// 购物车单价计算  checkbox change event
				$(".shop-cont").on("change", ".check-item input[type=checkbox]", function(e) {
					
						calPrice();
					

				});

				function calPrice() {

					var sum = 0;

					var els = $(".shop-cont").find(".shop-item input[type=checkbox]:checked");
					els.each(function() {

						var _price = $(this).closest(".shop-item").find(".price").text() || 0;
						var _count = $(this).closest(".shop-item").find(".num").val() || 0;
						sum += Number(_price) * Number(_count);

					});

					$(".shop-select").find(".price").text(sum.toFixed(2));
					$(".shop-select").find(".count").text(els.length);

				}
			});
		</script>

	</body>

</html>